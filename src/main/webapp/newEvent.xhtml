<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<ui:composition template="/WEB-INF/templates/site/newEvent.xhtml">
	<ui:define name="left">
		<h:form>
			<p:fileUpload fileUploadListener="#{NewEventBean.handleFileUpload}"
				mode="advanced" multiple="true" auto="true" update="dataTable"
				allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />

			<p:dataTable id="dataTable" var="image"
				value="#{NewEventBean.images}">
				<p:column style="text-align: center;">
					<f:facet name="header">
						<h:outputText value="Preview" />
					</f:facet>
					<p:lightBox>
						<h:outputLink
							value="/route66/image/#{NewEventBean.event.eventSeqId}/#{image.image.name}"
							title="#{image.image.name}">
							<h:graphicImage
								value="/image/#{NewEventBean.event.eventSeqId}/#{image.image.name}"
								width="50" height="50" />
						</h:outputLink>
					</p:lightBox>
					<h:outputText value="#{image.image.prettySize}"
						style="display: block;" />
					<h:outputText
						value="/route66/image/#{NewEventBean.event.eventSeqId}/#{image.image.encodedName}" />
				</p:column>
				<p:column>
					<f:facet name="header">
						<h:outputText value="Action" />
					</f:facet>
					<p:commandLink value="Delete" action="#{NewEventBean.deleteImage}"
						update="@form" ajax="true">
						<f:param name="imageSeqId"
							value="#{image.image.articleImageSeqId}" />
					</p:commandLink>
				</p:column>
			</p:dataTable>
			<h:outputText value="Instructions: " />
		</h:form>
	</ui:define>
	<ui:define name="center">
		<h:panelGrid columns="1" style="width: 100%; text-align: center;">
			<h:outputText
				style="font-weight: bold; font-size: 16pt; border-bottom: 2px solid black;"
				value="Create New Event" />
			<h:form>
				<h:panelGrid columns="2" style="width: 100%;"
					columnClasses="alignTopColumn,alignTopColumn">
					<p:fieldset legend="General">
						<h:panelGrid columns="3">
							<h:outputLabel value="Title:" for="titleInput" />
							<p:inputText id="titleInput" value="#{NewEventBean.event.title}"
								required="true" requiredMessage="Required" />
							<p:message for="titleInput" />
							<h:outputLabel for="startDateInput" value="Start Date/Time:" />
							<p:calendar value="#{NewEventBean.event.startDtg}"
								showOn="button" maxlength="20" size="20" id="startDateInput"
								pattern="MM/dd/yyyy hh:mm a" required="true"
								requiredMessage="Required" />
							<p:message for="startDateInput" />
							<h:outputLabel for="endDateInput" value="End Date/Time:" />
							<p:calendar value="#{NewEventBean.event.endDtg}" showOn="button"
								maxlength="20" size="20" id="endDateInput"
								pattern="MM/dd/yyyy hh:mm a" required="true"
								requiredMessage="Required" />
							<p:message for="endDateInput" />
							<h:outputLabel for="typeInput" value="Type:" />
							<p:selectOneMenu id="typeInput"
								value="#{NewEventBean.event.eventTypeCd}" required="true"
								requiredMessage="Required"
								validator="#{NewEventBean.validateNotEmpty}">
								<f:selectItem itemLabel="Select..." itemValue="NONE" />
								<f:selectItems value="#{NewEventBean.eventTypes}"
									var="eventType" itemLabel="#{eventType.description}"
									itemValue="#{eventType.code}" />
							</p:selectOneMenu>
							<p:message for="typeInput" />
							<h:outputLabel for="statusInput" value="Status:" rendered="#{UserSession.isModerator}"/>
							<p:selectOneMenu id="statusInput"
								value="#{NewEventBean.event.eventStatusCd}" required="true"
								requiredMessage="Required"
								validator="#{NewEventBean.validateNotEmpty}" rendered="#{UserSession.isModerator}">
								<f:selectItems value="#{NewEventBean.statusCodeTypes}"
									var="status" itemLabel="#{status.description}"
									itemValue="#{status.code}" />
							</p:selectOneMenu>
							<p:message for="statusInput" rendered="#{UserSession.isModerator}"/>
						</h:panelGrid>
					</p:fieldset>
					<p:fieldset legend="Address">
						<h:panelGrid columns="3">
							<h:outputLabel for="address1Input" value="Address 1:" />
							<p:inputText id="address1Input"
								value="#{NewEventBean.event.address1}" required="true"
								requiredMessage="Required" />
							<p:message for="address1Input" />
							<h:outputLabel for="address2Input" value="Address 2:" />
							<p:inputText id="address2Input"
								value="#{NewEventBean.event.address2}" />
							<p:message for="address2Input" />
							<h:outputLabel for="cityInput" value="City:" />
							<p:inputText id="cityInput" value="#{NewEventBean.event.city}"
								required="true" requiredMessage="Required" />
							<p:message for="cityInput" />
							<h:outputLabel for="stateInput" value="State:" />
							<p:selectOneMenu id="stateInput"
								value="#{NewEventBean.event.stateCd}" required="true"
								requiredMessage="Required"
								validator="#{NewEventBean.validateNotEmpty}">
								<f:selectItem itemLabel="Select..." itemValue="NONE" />
								<f:selectItems value="#{NewEventBean.states}" var="state"
									itemLabel="#{state.name}" itemValue="#{state.code}" />
							</p:selectOneMenu>
							<p:message for="stateInput" />
							<h:outputLabel for="zipInput" value="Zip Code:" />
							<p:inputText id="zipInput" value="#{NewEventBean.event.zipCode}"
								required="true" requiredMessage="Required" />
							<p:message for="zipInput" />
						</h:panelGrid>
					</p:fieldset>
				</h:panelGrid>
				<h:panelGrid style="width: 100%; text-align: center;">
					<p:editor id="editor" value="#{NewEventBean.event.content}"
						required="true" requiredMessage="Required"
						style="width: 100%; text-align: center;" />
					<h:panelGrid columns="2" style="width: 100%;">
						<h:panelGroup style="float: left; display: inline;">
							<p:commandButton value="Preview" actionListener="#{NewEventBean.save}"
								ajax="true" oncomplete="eventDialog.show()" update=":eventPreviewDialog"/>
						</h:panelGroup>
						<h:panelGroup style="float: right;">
							<p:commandButton value="Submit" action="#{NewEventBean.save}" ajax="false" />
							<p:commandButton value="Cancel" action="#{NewEventBean.delete}" ajax="false" />
						</h:panelGroup>
					</h:panelGrid>
				</h:panelGrid>
			</h:form>
		</h:panelGrid>
		<p:dialog id="eventPreviewDialog" widgetVar="eventDialog" header="Event Preview"
			resizable="true" maximizable="true" >
			<h:panelGrid columns="1" style="width: 100%; text-align: center;">
				<h:outputText
					style="font-weight: bold; font-size: 16pt; border-bottom: 2px solid black;"
					value="#{NewEventBean.event.title}" />
			</h:panelGrid>
			<h:panelGrid columns="1" style="width: 100%;">
				<h:outputText value="#{NewEventBean.event.content}" escape="false"/>
			</h:panelGrid>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>